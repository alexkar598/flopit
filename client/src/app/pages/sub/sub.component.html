<div class="page">
  <app-post-list [subName]="(route.paramMap | async)!.get('subName')!" />

  <div class="sidebar">
    @if (sub$ | async; as sub) {
      <nb-card class="barre-infos">
        <nb-card-header
          style="background-image: url('{{ sub.bannerUrl ?? '' }}');"
        >
          <div>
            <h1 class="nom-sub">f/{{ sub.name }}</h1>
          </div>

          <div>
            @if (sub.iconUrl) {
              <nb-user
                onlyPicture
                [picture]="sub.iconUrl"
                color="#fff"
                size="large"
              />
            } @else {
              <nb-icon class="icone" icon="globe-2-outline" />
            }
          </div>
        </nb-card-header>

        <nb-card-body>
          <button
            nbButton
            [status]="sub.isFollowing ? 'basic' : 'primary'"
            class="bouton-rejoindre"
            (click)="toggleFollow()"
          >
            {{ sub.isFollowing ? "Quitter" : "Rejoindre" }}
          </button>

          @if (!sub.isFollowing) {
            <p>{{ sub.description }}</p>
          } @else {
            @if (this.editing) {
              <!--
              https://css-tricks.com/the-cleanest-trick-for-autogrowing-textareas/
              i hate this
              -->
              <div
                class="grow-wrap"
                [attr.data-replicated-value]="newDescription"
              >
                <textarea
                  maxlength="512"
                  placeholder="Description"
                  [(ngModel)]="newDescription"
                ></textarea>
              </div>
            } @else {
              <p>{{ sub.description }}</p>
            }

            <div class="edit-description">
              @if (this.editing) {
                <button
                  class="edit-button"
                  nbButton
                  size="large"
                  shape="round"
                  (click)="editDescription()"
                >
                  <nb-icon icon="close-outline" />
                </button>
              }

              <button
                class="edit-button"
                nbButton
                size="large"
                shape="round"
                (click)="this.editing ? saveDescription() : editDescription()"
              >
                <nb-icon
                  [icon]="this.editing ? 'checkmark-outline' : 'edit-outline'"
                />
              </button>
            </div>
          }

          <div class="stats-item">
            <div class="stats">
              <span class="stats-data">{{ sub.followers.totalCount }}</span>
              <p>Membre{{ sub.followers.totalCount !== 1 ? "s" : "" }}</p>
            </div>

            <div class="stats">
              <span class="stats-data">{{ sub.posts.totalCount }}</span>
              <p>Publication{{ sub.posts.totalCount !== 1 ? "s" : "" }}</p>
            </div>
          </div>
        </nb-card-body>
      </nb-card>
    } @else {
      <nb-card
        class="barre-infos-loading"
        [nbSpinner]="true"
        nbSpinnerStatus="primary"
      >
        <nb-card-body />
      </nb-card>
    }
  </div>
</div>
